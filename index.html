<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DDCAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    #main-title {
      font-size: 80px;
      font-weight: 700;
      color: #000000;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    #main-subtitle {
      margin-top: 8px;
      font-size: 15px;
      font-weight: 500;
      color: #222;
      text-align: center;
      line-height: 1.4;
      display: inline-block;
      transform-origin: center;
    }
    #main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      text-align: center;
      width: fit-content;
    }
    #auth-actions {
      display: flex;
      gap: 10px;
      margin-top: 6px;
    }
    #flight-home {
      display: none;
      margin-top: 6px;
    }
    .auth-button {
      font-size: 14px;
      font-weight: 700;
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid #000;
      background: #000;
      color: #fff;
      cursor: pointer;
    }
    .auth-button.secondary {
      background: #fff;
      color: #000;
    }
    #login-form,
    #signin-form {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
      min-width: 240px;
    }
    #login-form label,
    #signin-form label {
      font-size: 12px;
      text-align: left;
      color: #333;
    }
    #login-form input,
    #signin-form input,
    #signin-form select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }
    #login-submit,
    #signin-submit {
      background: #000;
      color: #fff;
      border: 1px solid #000;
      font-weight: 700;
      cursor: pointer;
      padding: 8px 14px;
      border-radius: 8px;
    }
    #login-error,
    #signin-error {
      display: none;
      font-size: 12px;
      color: #cc0000;
      text-align: left;
    }
    #top-left {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 12;
    }
    #top-right {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 12;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    #menuBtn,
    #profileBtn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #000;
      background: #000;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #profile-menu,
    #nav-menu {
      position: fixed;
      top: 56px;
      background: #000000;
      color: #fff;
      border-radius: 10px;
      padding: 8px;
      display: none;
      flex-direction: column;
      gap: 6px;
      border: 1px solid rgba(255,255,255,0.15);
      z-index: 11;
      min-width: 160px;
      font-size: 14px;
    }
    #profile-menu { right: 16px; }
    #nav-menu { left: 16px; }
    #profile-menu button,
    #nav-menu button {
      background: transparent;
      color: #fff;
      border: none;
      text-align: left;
      padding: 6px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    #profile-menu button:hover,
    #nav-menu button:hover {
      background: rgba(255,255,255,0.12);
    }
    .submenu {
      padding-left: 18px;
      font-size: 13px;
      opacity: 0.95;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="top-left" class="hidden">
    <button id="menuBtn" aria-label="Menu">☰</button>
  </div>
  <div id="top-right" class="hidden">
    <button id="profileBtn" aria-label="Profile">J</button>
  </div>
  <div id="profile-menu" aria-label="Profile menu">
    <button id="my-page-link" type="button">My Page</button>
    <button id="logout-button" type="button">Log out</button>
  </div>
  <div id="nav-menu" aria-label="Navigation menu">
    <button type="button">About Us</button>
    <button type="button">Information</button>
    <button type="button">Casting&Alert</button>
  </div>
  <div id="main-container">
    <div id="main-title">DDCAS</div>
    <div id="main-subtitle">Dynamic Disaster Casting & Alert System</div>
    <div id="flight-home">
      <button id="flight-home-link" class="auth-button" type="button">Flight</button>
    </div>
    <div id="auth-actions">
      <button id="login-toggle" class="auth-button" type="button">Log in</button>
      <button id="signin-button" class="auth-button secondary" type="button">Sign in</button>
    </div>
    <form id="login-form">
      <div>
        <label for="login-id">ID</label>
        <input id="login-id" type="text" autocomplete="username" />
      </div>
      <div>
        <label for="login-password">Password</label>
        <input id="login-password" type="password" autocomplete="current-password" />
      </div>
      <button id="login-submit" type="submit">Log in</button>
      <div id="login-error">ID 또는 Password가 올바르지 않습니다.</div>
    </form>
    <form id="signin-form">
      <div>
        <label for="signin-id">ID</label>
        <input id="signin-id" type="text" autocomplete="username" />
      </div>
      <div>
        <label for="signin-password">Password</label>
        <input id="signin-password" type="password" autocomplete="new-password" />
      </div>
      <div>
        <label for="signin-role">Role</label>
        <select id="signin-role">
          <option value="crew" selected>Crew</option>
          <option value="admin">Admin</option>
        </select>
      </div>
      <button id="signin-submit" type="submit">Sign in</button>
      <div id="signin-error">이미 있는 ID입니다.</div>
    </form>
  </div>
  <script>
    const loginToggle = document.getElementById('login-toggle');
    const loginId = document.getElementById('login-id');
    const loginPassword = document.getElementById('login-password');
    const loginError = document.getElementById('login-error');
    const signinButton = document.getElementById('signin-button');
    const signinForm = document.getElementById('signin-form');
    const signinId = document.getElementById('signin-id');
    const signinPassword = document.getElementById('signin-password');
    const signinError = document.getElementById('signin-error');
    const signinRole = document.getElementById('signin-role');
    const loginForm = document.getElementById('login-form');
    const authActions = document.getElementById('auth-actions');
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profile-menu');
    const menuBtn = document.getElementById('menuBtn');
    const navMenu = document.getElementById('nav-menu');
    const myPageLink = document.getElementById('my-page-link');
    const logoutButton = document.getElementById('logout-button');
    const flightHomeLink = document.getElementById('flight-home-link');
    const flightHome = document.getElementById('flight-home');
    const topLeft = document.getElementById('top-left');
    const topRight = document.getElementById('top-right');

    const ACCOUNT_ID = 'JEJUAWS';
    const ACCOUNT_PASSWORD = '1111';
    const ADMIN_ACCOUNT_ID = 'DDCAS';
    const ADMIN_ACCOUNT_PASSWORD = '1111';
    const LOGIN_STORAGE_KEY = 'ddcas_logged_in';
    const CURRENT_USER_KEY = 'ddcas_current_user';
    const CURRENT_ROLE_KEY = 'ddcas_current_role';
    const ACCOUNTS_KEY = 'ddcas_accounts';
    let isLoggedIn = false;
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('logout') === '1') {
      localStorage.removeItem(LOGIN_STORAGE_KEY);
      localStorage.removeItem(CURRENT_USER_KEY);
      localStorage.removeItem(CURRENT_ROLE_KEY);
    }

    function getAccounts() {
      try {
        const raw = localStorage.getItem(ACCOUNTS_KEY);
        const defaults = [
          { id: ACCOUNT_ID, password: ACCOUNT_PASSWORD, role: 'crew' },
          { id: ADMIN_ACCOUNT_ID, password: ADMIN_ACCOUNT_PASSWORD, role: 'admin' },
        ];
        if (!raw) return defaults;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || parsed.length === 0) {
          return defaults;
        }
        return parsed.map((acc) => ({
          ...acc,
          role: acc.role || (acc.id === ADMIN_ACCOUNT_ID ? 'admin' : 'crew'),
        }));
      } catch (err) {
        return [
          { id: ACCOUNT_ID, password: ACCOUNT_PASSWORD, role: 'crew' },
          { id: ADMIN_ACCOUNT_ID, password: ADMIN_ACCOUNT_PASSWORD, role: 'admin' },
        ];
      }
    }

    function setAccounts(accounts) {
      localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(accounts));
    }

    function setLoggedInUI() {
      if (isLoggedIn) {
        authActions.classList.add('hidden');
        flightHome.style.display = 'block';
        loginForm.style.display = 'none';
        signinForm.style.display = 'none';
        topLeft.classList.remove('hidden');
        topRight.classList.remove('hidden');
        const role = localStorage.getItem(CURRENT_ROLE_KEY);
        myPageLink.textContent = role === 'admin' ? 'Status' : 'My Page';
        profileBtn.textContent = role === 'admin' ? 'ADMIN' : 'J';
      } else {
        authActions.classList.remove('hidden');
        flightHome.style.display = 'none';
        loginForm.style.display = 'none';
        signinForm.style.display = 'none';
        topLeft.classList.add('hidden');
        topRight.classList.add('hidden');
        profileMenu.style.display = 'none';
        navMenu.style.display = 'none';
        profileBtn.textContent = 'J';
      }
    }

    function syncLoginState() {
      const stored = localStorage.getItem(LOGIN_STORAGE_KEY);
      isLoggedIn = stored === 'true';
      setLoggedInUI();
    }

    syncLoginState();

    loginToggle.addEventListener('click', () => {
      authActions.classList.add('hidden');
      loginForm.style.display = 'flex';
      signinForm.style.display = 'none';
      loginId.focus();
    });

    signinButton.addEventListener('click', () => {
      authActions.classList.add('hidden');
      signinForm.style.display = 'flex';
      loginForm.style.display = 'none';
      signinId.focus();
    });

    loginForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const idValue = loginId.value.trim();
      const passwordValue = loginPassword.value;
      const accounts = getAccounts();
      const matched = accounts.find((acc) => acc.id === idValue && acc.password === passwordValue);
      if (!matched) {
        loginError.style.display = 'block';
        return;
      }
      loginError.style.display = 'none';
      isLoggedIn = true;
      localStorage.setItem(LOGIN_STORAGE_KEY, 'true');
      localStorage.setItem(CURRENT_USER_KEY, idValue);
      localStorage.setItem(CURRENT_ROLE_KEY, matched.role || 'crew');
      setLoggedInUI();
      loginId.value = '';
      loginPassword.value = '';
    });

    signinForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const idValue = signinId.value.trim();
      const passwordValue = signinPassword.value;
      const accounts = getAccounts();
      const exists = accounts.some((acc) => acc.id === idValue);
      if (exists || idValue === '') {
        signinError.style.display = 'block';
        return;
      }
      signinError.style.display = 'none';
      accounts.push({ id: idValue, password: passwordValue, role: signinRole.value });
      setAccounts(accounts);
      signinId.value = '';
      signinPassword.value = '';
      signinRole.value = 'crew';
      authActions.classList.remove('hidden');
      signinForm.style.display = 'none';
    });

    profileBtn.addEventListener('click', () => {
      const isOpen = profileMenu.style.display === 'flex';
      profileMenu.style.display = isOpen ? 'none' : 'flex';
    });

    menuBtn.addEventListener('click', () => {
      const isOpen = navMenu.style.display === 'flex';
      navMenu.style.display = isOpen ? 'none' : 'flex';
    });

    myPageLink.addEventListener('click', () => {
      const role = localStorage.getItem(CURRENT_ROLE_KEY);
      window.location.href = role === 'admin' ? './status.html' : './my_page.html';
    });

    flightHomeLink.addEventListener('click', () => {
      window.location.href = './index_hong.html';
    });

    const mainTitle = document.getElementById('main-title');
    const mainSubtitle = document.getElementById('main-subtitle');

    function syncTitleWidths() {
      const titleWidth = mainTitle.getBoundingClientRect().width;
      const subtitleWidth = mainSubtitle.getBoundingClientRect().width;
      if (subtitleWidth > 0) {
        const scale = titleWidth / subtitleWidth;
        mainSubtitle.style.transform = `scaleX(${scale})`;
      }
    }

    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(syncTitleWidths);
    } else {
      window.addEventListener('load', syncTitleWidths);
    }
    window.addEventListener('resize', syncTitleWidths);

    logoutButton.addEventListener('click', () => {
      isLoggedIn = false;
      localStorage.removeItem(LOGIN_STORAGE_KEY);
      localStorage.removeItem(CURRENT_USER_KEY);
      localStorage.removeItem(CURRENT_ROLE_KEY);
      setLoggedInUI();
      window.location.href = './index.html';
    });

    document.addEventListener('click', (event) => {
      if (!profileMenu.contains(event.target) && !profileBtn.contains(event.target)) {
        profileMenu.style.display = 'none';
      }
      if (!navMenu.contains(event.target) && !menuBtn.contains(event.target)) {
        navMenu.style.display = 'none';
      }
    });
  </script>
</body>
</html>
